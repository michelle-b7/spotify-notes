name: Folder-Specific PR Discord Notifications

on:
  pull_request:
    paths:
      - 'extension/**'
      - 'webapp/**'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for Extension Changes
        id: check_extension
        run: |
          if git diff --name-only origin/${{ github.base_ref }}...origin/${{ github.head_ref }} | grep -q "^extension/"; then
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      - name: Notify Discord (Extension)
        if: steps.check_extension.outputs.changed == 'true'
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_EXTENSION }}
          content: "**Extension PR:**[${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }}) by ${{ github.actor }}!"

      - name: Check for Webapp Changes
        id: check_webapp
        run: |
          if git diff --name-only origin/${{ github.base_ref }}...origin/${{ github.head_ref }} | grep -q "^webapp/"; then
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      - name: Notify Discord (Webapp)
        if: steps.check_webapp.outputs.changed == 'true'
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_WEBAPP }}
          content: "**Webapp PR:**[${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }}) by ${{ github.actor }}!"